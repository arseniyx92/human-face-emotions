# Human Face Emotions Classification

–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —ç–º–æ—Ü–∏–π –Ω–∞ –ª–∏—Ü–∞—Ö –ª—é–¥–µ–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º PyTorch Lightning, Hydra –∏ MLflow.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–û –ø—Ä–æ–µ–∫—Ç–µ](#–æ-–ø—Ä–æ–µ–∫—Ç–µ)
- [–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á–∏](#–ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∞-–∑–∞–¥–∞—á–∏)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-—Ä–µ—à–µ–Ω–∏—è)
- [–£—Å—Ç–∞–Ω–æ–≤–∫–∞](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
- [–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö](#–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-–¥–∞–Ω–Ω—ã—Ö)
- [–û–±—É—á–µ–Ω–∏–µ](#–æ–±—É—á–µ–Ω–∏–µ)
- [–ò–Ω—Ñ–µ—Ä–µ–Ω—Å](#–∏–Ω—Ñ–µ—Ä–µ–Ω—Å)
- [–ú–µ—Ç—Ä–∏–∫–∏ –∏ –∫–∞—á–µ—Å—Ç–≤–æ](#–º–µ—Ç—Ä–∏–∫–∏-–∏-–∫–∞—á–µ—Å—Ç–≤–æ)

## –û –ø—Ä–æ–µ–∫—Ç–µ

**Human Face Emotions Classification** ‚Äî —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —ç–º–æ—Ü–∏–π –ø–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏—Ö –ª–∏—Ü. –ü—Ä–æ–µ–∫—Ç —Ä–µ—à–∞–µ—Ç –∑–∞–¥–∞—á—É –º–Ω–æ–≥–æ–∫–ª–∞—Å—Å–æ–≤–æ–π –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–∞ 5 –∫–∞—Ç–µ–≥–æ—Ä–∏–π —ç–º–æ—Ü–∏–π: **Angry, Fear, Happy, Sad, Surprised**.

**–ê–≤—Ç–æ—Ä:** –•–ª—ã—Ç—á–∏–µ–≤ –ê—Ä—Å–µ–Ω–∏–π –î–µ–Ω–∏—Å–æ–≤–∏—á

**–¶–µ–Ω–Ω–æ—Å—Ç—å —Ä–µ—à–µ–Ω–∏—è:**
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (—Ñ–∏–ª—å—Ç—Ä—ã AR, –∏–≥—Ä—ã)
- –°–∏—Å—Ç–µ–º—ã –∞–Ω–∞–ª–∏–∑–∞ –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –≤ –ø—Å–∏—Ö–æ–ª–æ–≥–∏–∏ –∏ –Ω–µ–π—Ä–æ–±–∏–æ–ª–æ–≥–∏–∏
- –°–∏—Å—Ç–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

## –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á–∏

**–°—É—Ö–æ–π –æ—Å—Ç–∞—Ç–æ–∫:** –ú–Ω–æ–≥–æ–∫–ª–∞—Å—Å–æ–≤–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —ç–º–æ—Ü–∏–π –ø–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏—Ö –ª–∏—Ü –Ω–∞ 5 –∫–∞—Ç–µ–≥–æ—Ä–∏–π.

**–û—Å–Ω–æ–≤–Ω—ã–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:**
- –í—ã—Å–æ–∫–∞—è –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–æ—Å–≤–µ—â–µ–Ω–∏–µ, —Ä–∞–∫—É—Ä—Å, –≤–æ–∑—Ä–∞—Å—Ç, —ç—Ç–Ω–∏—á–µ—Å–∫–∞—è –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å)
- –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∞—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã, –≤–æ–¥—è–Ω—ã–µ –∑–Ω–∞–∫–∏ –∏–ª–∏ –Ω–µ—è–≤–Ω–æ –≤—ã—Ä–∞–∂–µ–Ω–Ω—ã–µ —ç–º–æ—Ü–∏–∏
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å —É—Å—Ç–æ–π—á–∏–≤–æ–≥–æ –æ–±–æ–±—â–µ–Ω–∏—è –Ω–∞ —Ä–∞–∑–Ω–æ—Ä–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- Input: –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ª–∏—Ü–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JPEG/PNG
- Output: JSON —Å –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω–æ–π —ç–º–æ—Ü–∏–µ–π –∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—è–º–∏ –¥–ª—è –≤—Å–µ—Ö –∫–ª–∞—Å—Å–æ–≤
- –¶–µ–ª–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏: Accuracy > 0.88, Weighted F1-Score > 0.87

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

### –ë–µ–π–∑–ª–∞–π–Ω –º–æ–¥–µ–ª—å
- –ü—Ä–æ—Å—Ç–∞—è CNN (3-4 —Å–≤–µ—Ä—Ç–æ—á–Ω—ã—Ö –±–ª–æ–∫–∞ + –ø–æ–ª–Ω–æ—Å–≤—è–∑–Ω—ã–π –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä)
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∞—É–≥–º–µ–Ω—Ç–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- –¶–µ–ª—å: –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ accuracy ~0.89 –∫–∞–∫ —Ç–æ—á–∫—É –æ—Ç—Å—á–µ—Ç–∞

### –û—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** –ì–ª—É–±–æ–∫–∞—è CNN –Ω–∞ –æ—Å–Ω–æ–≤–µ EfficientNet-B0/ResNet-18 —Å fine-tuning
- **–ê—É–≥–º–µ–Ω—Ç–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:**
  - RandomHorizontalFlip
  - RandomRotation (¬±10¬∞)
  - ColorJitter (—è—Ä–∫–æ—Å—Ç—å, –∫–æ–Ω—Ç—Ä–∞—Å—Ç, –Ω–∞—Å—ã—â–µ–Ω–Ω–æ—Å—Ç—å)
  - RandomAffine, RandomPerspective
  - –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è (—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ ImageNet)
- **–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä:** Global Average Pooling + FC —Å Dropout (0.4-0.5)
- **Loss:** CrossEntropyLoss
- **Optimizer:** AdamW —Å CosineAnnealingLR

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- Self-Supervised Pretext Task (Masked Autoencoding)
- Vision Transformer (ViT-tiny) –≤ –∫–∞—á–µ—Å—Ç–≤–µ —ç–Ω–∫–æ–¥–µ—Ä–∞
- –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –Ω–∞ –¥–∞—Ç–∞—Å–µ—Ç–µ –ª–∏—Ü –±–µ–∑ –º–µ—Ç–æ–∫

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.11+
- Poetry –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
- GPU (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –æ–±—É—á–µ–Ω–∏—è

### –®–∞–≥–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git clone <repository-url>
cd human-face-emotions

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
poetry install

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ pre-commit hooks
poetry run pre-commit install
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```bash
human-face-emotions/
‚îú‚îÄ‚îÄ configs/                      # Hydra –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ config.yaml              # –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥
‚îÇ   ‚îú‚îÄ‚îÄ model/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cnn.yaml
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cnn_large.yaml
‚îÇ   ‚îú‚îÄ‚îÄ training/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ default.yaml
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ fast.yaml
‚îÇ   ‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ default.yaml
‚îÇ   ‚îî‚îÄ‚îÄ logging/
‚îÇ       ‚îú‚îÄ‚îÄ mlflow.yaml
‚îÇ       ‚îî‚îÄ‚îÄ tensorboard.yaml
‚îú‚îÄ‚îÄ data/                         # –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ Angry/
‚îÇ   ‚îú‚îÄ‚îÄ Fear/
‚îÇ   ‚îú‚îÄ‚îÄ Happy/
‚îÇ   ‚îú‚îÄ‚îÄ Sad/
‚îÇ   ‚îî‚îÄ‚îÄ Surprised/
‚îú‚îÄ‚îÄ human_face_emotions/          # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
‚îÇ   ‚îú‚îÄ‚îÄ modules/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ faces_dataset.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ infer_dataset.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ model.py
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ train.py
‚îÇ   ‚îî‚îÄ‚îÄ infer.py
‚îú‚îÄ‚îÄ checkpoints/                  # –°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ outputs/                      # Hydra outputs
‚îú‚îÄ‚îÄ mlruns/                       # MLflow –¥–∞–Ω–Ω—ã–µ
‚îú‚îÄ‚îÄ docs/                         # Sphinx –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ tests/                        # –¢–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ pyproject.toml
‚îú‚îÄ‚îÄ .pre-commit-config.yaml
‚îî‚îÄ‚îÄ README.md
```

## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

```bash
data/
‚îú‚îÄ‚îÄ Angry/
‚îÇ   ‚îú‚îÄ‚îÄ 0.png
‚îÇ   ‚îú‚îÄ‚îÄ 1.png
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ Fear/
‚îÇ   ‚îú‚îÄ‚îÄ 0.png
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ Happy/
‚îÇ   ‚îú‚îÄ‚îÄ 0.png
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ Sad/
‚îÇ   ‚îú‚îÄ‚îÄ 0.png
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ Surprised/
    ‚îú‚îÄ‚îÄ 0.png
    ‚îî‚îÄ‚îÄ ...
```
–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: .png, .jpg, .jpeg

## –û–±—É—á–µ–Ω–∏–µ

#### –ë–∞–∑–æ–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ (GPU)
```bash
poetry run python -m human_face_emotions.train
```

### –û–±—É—á–µ–Ω–∏–µ –Ω–∞ CPU
```bash
poetry run python -m human_face_emotions.train training.accelerator=cpu
```

### –ë—ã—Å—Ç—Ä–æ–µ –æ–±—É—á–µ–Ω–∏–µ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
```bash
poetry run python -m human_face_emotions.train training=testing_2_epochs
```

## –ò–Ω—Ñ–µ—Ä–µ–Ω—Å

### –û–¥–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
```bash
poetry run python -m human_face_emotions.infer \
    '+checkpoint_path="checkpoints/emotion-epoch=01-val_loss=1.27.ckpt"' \
    '+images_path="data/Happy/25.png"'
```

### –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
```bash
poetry run python -m human_face_emotions.infer \
    '+checkpoint_path="checkpoints/emotion-epoch=01-val_loss=1.27.ckpt"' \
    '+images_path="./test_images/"'
```

### –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞

```bash
============================================================
Inference Configuration:
============================================================
Checkpoint: checkpoints/emotion-epoch=01-val_loss=1.27.ckpt
Images: data/Happy/25.png
Output: stdout
Accelerator: cpu
============================================================

Results:
{
    "model_checkpoint": "checkpoints/emotion-epoch=01-val_loss=1.27.ckpt",
    "images_path": "data/Happy/25.png",
    "num_images": 1,
    "predictions": [
        {
            "image_path": "data/Happy/25.png",
            "predicted_class": 2,
            "predicted_emotion": "Happy",
            "confidence": 0.8934,
            "all_probabilities": {
                "Angry": 0.0234,
                "Fear": 0.0123,
                "Happy": 0.8934,
                "Sad": 0.0456,
                "Surprised": 0.0253
            }
        }
    ]
}

============================================================
Summary:
============================================================
  Happy: 1
------------------------------------------------------------
  25.png: Happy (89.34%)
============================================================
```

### –ó–∞–ø—É—Å–∫ MLflow UI
```bash
poetry run mlflow ui --backend-store-uri ./mlruns --port 5000
```

## –ú–µ—Ç—Ä–∏–∫–∏ –∏ –∫–∞—á–µ—Å—Ç–≤–æ

### –¶–µ–ª–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
| –ú–µ—Ç—Ä–∏–∫–∞ | –¶–µ–ª—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|------|----------|
| **Accuracy** | **>0.88** | –û—Å–Ω–æ–≤–Ω–∞—è –º–µ—Ç—Ä–∏–∫–∞ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ |
| **Weighted F1** | **>0.87** | –ë–∞–ª–∞–Ω—Å precision/recall |
| **Per-Class Recall** | **>0.80** | –ö–∞—á–µ—Å—Ç–≤–æ –ø–æ –∫–∞–∂–¥–æ–º—É –∫–ª–∞—Å—Å—É |

### Baseline (Kaggle)
- **–ü—Ä–æ—Å—Ç–∞—è CNN:** Accuracy ‚âà 0.8955
- **–ù–∞—à–∞ —Ü–µ–ª—å:** –ü—Ä–µ–≤—ã—Å–∏—Ç—å 0.90 —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π

### –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å
Train/Val/Test: 64%/16%/20% (—Å—Ç—Ä–∞—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–æ)

Random Seed: 281 (–≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å)

–†–∞–Ω–Ω—è—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞: –ø–æ val_loss (patience=10)

–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: MLflow –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤